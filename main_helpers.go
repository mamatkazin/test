package main

import (
	"encoding/json"
	"log"
	"net/http"
	"os"

	"nami/nami_track/controllers/common"
)

func initLogFile() (f *os.File, err error) {
	f, err = os.OpenFile("KoT.log", os.O_APPEND|os.O_CREATE|os.O_RDWR, 0666)

	if err != nil {
		log.Printf("panic: Не возомжно создать лог файл. Ошибка: %s", err.Error())
		return
	}

	log.Println("success: Лог файл успешно создан.")

	// говорим логгеру выводить данные в наш файл
	log.SetOutput(f)

	log.SetFlags(log.Ldate | log.Ltime | log.Lshortfile)

	return
}

func initConfigFile() (err error) {
	f, err := os.Open("config.json")

	if err != nil {
		log.Printf("panic: Не возомжно открыть конфигурационный файл. Ошибка: %s", err.Error())
		return
	}

	defer f.Close()

	decoder := json.NewDecoder(f)

	err = decoder.Decode(&common.G_CONFIG)

	if err != nil {
		log.Printf("panic: Не возомжно декодировать конфигурационный файл. Ошибка: %s", err.Error())
		return
	}

	log.Println("success: Конфигурационные данные успешно загружены.")

	return
}

func h_WriteData(access bool, data interface{}, user_id int, w http.ResponseWriter) (err error) {
	var b []byte

	if access {
		if b, err = json.Marshal(data); err != nil {
			panic(common.ProcessingError(err.Error()))
		}

		w.Write(b)
	} else {
		w.WriteHeader(405)
	}

	return
}

func h_Recover(rec interface{}) (res []byte) {
	var (
		err  error
		data = common.S_Data{Valid: false, Errors: make([]string, 0)}
	)

	data.Errors = append(data.Errors, common.GetRecoverErrorText(rec))

	if res, err = json.Marshal(data); err != nil {
		res = []byte(common.ProcessingError(err.Error()))
	}

	return
}

const S = `
630889
  630890
  630891
  630892
  630893
  630894
  630895
  630896
  630897
  630898
  630899
  630900
  630901
  630902
  630903
  630904
  630905
  630906
  630907
  630908
  630909
  630910
  630911
  630912
  630913
  630914
  630915
  630916
  630917
  630918
  630919
  630920
  630921
  630922
  630923
  630924
  630925
  630926
  630927
  630928
  630929
  630930
  630931
  630932
  630933
  630934
  630935
  630936
  630937
  630938
  630939
  630940
  630941
  630942
  630943
  630944
  630945
  630946
  630947
  630948
  630949
  630950
  630951
  630952
  630953
  630954
  630955
  630956
  630957
  630958
  630959
  630985
  630960
  630961
  630962
  630963
  630964
  630965
  630966
  630967
  630968
  630969
  630970
  630971
  630972
  630973
  630974
  630975
  630976
  630977
  630978
  630979
  630980
  630981
  630982
  630983
  630984
  630986
  630987
  630988
  630989
  630990
  630991
  630992
  630993
  630994
  630995
  630996
  630997
  630998
  630999
  631000
  631001
  631002
  631003
  631004
  631005
  631006
  631007
  631008
  631009
  631010
  631011
  631012
  631013
  631014
  631015
  631016
  631017
  631018
  631019
  631020
  631021
  631022
  631023
  631024
  631025
  631026
  631027
  631028
  631029
  631030
  631031
  631032
  631034
  631035
  631036
  631037
  631038
  631039
  631040
  631041
  631042
  631043
  631044
  631045
  631046
  631047
  631048
  631049
  631050
  631051
  631052
  631053
  631054
  631055
  631056
  631057
  631058
  631059
  631060
  631061
  631062
  631063
  631064
  631065
  631066
  631067
  631068
  631069
  631070
  631071
  631072
  631073
  631074
  631075
  631076
  631077
  631078
  631079
  631105
  631033
  631080
  631081
  631082
  631083
  631084
  631085
  631086
  631087
  631088
  631089
  631090
  631091
  631092
  631093
  631094
  631095
  631096
  631097
  631098
  631099
  631100
  631101
  631102
  631103
  631104
  631106
  631107
  631108
  631109
  631110
  631111
  631112
  631113
  631114
  631115
  631116
  631117
  631118
  631119
  631120
  631121
  631122
  631123
  631124
  631125
  631126
  631127
  631128
  631129
  631130
  631131
  631132
  631133
  631134
  631135
  631136
  631137
  631138
  631139
  631140
  631141
  631142
  631143
  631144
  631145
  631146
  631147
  631148
  631149
  631150
  631151
  631152
  631154
  631155
  631156
  631157
  631158
  631159
  631160
  631161
  631162
  631163
  631164
  631165
  631166
  631167
  631168
  631169
  631170
  631171
  631172
  631173
  631174
  631175
  631176
  631177
  631178
  631179
  631180
  631181
  631182
  631183
  631184
  631185
  631186
  631187
  631188
  631189
  631190
  631191
  631192
  631193
  631194
  631195
  631196
  631197
  631198
  631199
  631225
  631153
  631200
  631201
  631202
  631203
  631204
  631205
  631206
  631207
  631208
  631209
  631210
  631211
  631212
  631213
  631214
  631215
  631216
  631217
  631218
  631219
  631220
  631221
  631222
  631223
  631224
  631226
  631227
  631228
  631229
  631230
  631231
  631232
  631233
  631234
  631235
  631236
  631237
  631238
  631239
  631240
  631241
  631242
  631243
  631244
  631245
  631246
  631247
  631248
  631249
  631250
  631251
  631252
  631253
  631254
  631255
  631256
  631257
  631258
  631259
  631260
  631261
  631262
  631263
  631264
  631265
  631266
  631267
  631268
  631269
  631270
  631271
  631272
  631274
  631275
  631276
  631277
  631278
  631279
  631280
  631281
  631282
  631283
  631284
  631285
  631286
  631287
  631288
  631289
  631290
  631291
  631292
  631293
  631294
  631295
  631296
  631297
  631298
  631299
  631300
  631301
  631302
  631303
  631304
  631305
  631306
  631307
  631308
  631309
  631310
  631311
  631312
  631313
  631314
  631315
  631316
  631317
  631318
  631319
  631345
  631273
  631320
  631321
  631322
  631323
  631324
  631325
  631326
  631327
  631328
  631329
  631330
  631331
  631332
  631333
  631334
  631335
  631336
  631337
  631338
  631339
  631340
  631341
  631342
  631343
  631344
  631346
  631347
  631348
  631349
  631350
  631351
  631352
  631353
  631354
  631355
  631356
  631357
  631358
  631359
  631360
  631361
  631362
  631363
  631364
  631365
  631366
  631367
  631368
  631369
  631370
  631371
  631372
  631373
  631374
  631375
  631376
  631377
  631378
  631379
  631380
  631381
  631382
  631383
  631384
  631385
  631386
  631387
  631388
  631389
  631390
  631391
  631392
  631394
  631395
  631396
  631397
  631398
  631399
  631400
  631401
  631402
  631403
  631404
  631405
  631406
  631407
  631408
  631409
  631410
  631411
  631412
  631413
  631414
  631415
  631416
  631417
  631418
  631419
  631420
  631421
  631422
  631423
  631424
  631425
  631426
  631427
  631428
  631429
  631430
  631431
  631432
  631433
  631434
  631435
  631436
  631437
  631438
  631439
  631465
  631393
  631440
  631441
  631442
  631443
  631444
  631445
  631446
  631447
  631448
  631449
  631450
  631451
  631452
  631453
  631454
  631455
  631456
  631457
  631458
  631459
  631460
  631461
  631462
  631463
  631464
  631466
  631467
  631468
  631469
  631470
  631471
  631472
  631473
  631474
  631475
  631476
  631477
  631478
  631479
  631480
  631481
  631482
  631483
  631484
  631485
  631486
  631487
  631488
  631489
  631490
  631491
  631492
  631493
  631494
  631495
  631496
  631497
  631498
  631499
  631500
  631501
  631502
  631503
  631504
  631505
  631506
  631507
  631508
  631509
  631510
  631511
  631512
  631514
  631515
  631516
  631517
  631518
  631519
  631520
  631521
  631522
  631523
  631524
  631525
  631526
  631527
  631528
  631529
  631530
  631531
  631532
  631533
  631534
  631535
  631536
  631537
  631538
  631539
  631540
  631541
  631542
  631543
  631544
  631545
  631546
  631547
  631548
  631549
  631550
  631551
  631552
  631553
  631554
  631555
  631556
  631557
  631558
  631559
  631585
  631513
  631560
  631561
  631562
  631563
  631564
  631565
  631566
  631567
  631568
  631569
  631570
  631571
  631572
  631573
  631574
  631575
  631576
  631577
  631578
  631579
  631580
  631581
  631582
  631583
  631584
  631586
  631587
  631588
  631589
  631590
  631591
  631592
  631593
  631594
  631595
  631596
  631597
  631598
  631599
  631600
  631601
  631602
  631603
  631604
  631605
  631606
  631607
  631608
  631609
  631610
  631611
  631612
  631613
  631614
  631615
  631616
  631617
  631618
  631619
  631620
  631621
  631622
  631623
  631624
  631625
  631626
  631627
  631628
  631629
  631630
  631631
  631632
  631633
  631634
  631635
  631636
  631637
  631638
  631639
  631640
  631641
  631642
  631643
  631644
  631645
  631646
  631647
  631648
  631649
  631650
  631651
  631652
  631653
  631654
  631655
  631656
  631657
  631658
  631659
  631660
  631661
  631662
  631663
  631664
  631665
  631666
  631667
  631668
  631669
  631670
  631671
  631672
  631673
  631674
  631675
  631676
  631677
  631678
  631679
  631705
  631680
  631681
  631682
  631683
  631684
  631685
  631686
  631687
  631688
  631689
  631690
  631691
  631692
  631693
  631694
  631695
  631696
  631697
  631698
  631699
  631700
  631701
  631702
  631703
  631704
  631706
  631707
  631708
  631709
  631710
  631711
  631712
  631713
  631714
  631715
  631716
  631717
  631718
  631719
  631720
  631721
  631722
  631723
  631724
  631725
  631726
  631727
  631728
  631729
  631730
  631731
  631732
  631733
  631734
  631735
  631736
  631737
  631738
  631739
  631740
  631741
  631742
  631743
  631744
  631745
  631746
  631747
  631748
  631749
  631750
  631751
  631752
  631754
  631755
  631756
  631757
  631758
  631759
  631760
  631761
  631762
  631763
  631764
  631765
  631766
  631767
  631768
  631769
  631770
  631771
  631772
  631773
  631774
  631775
  631776
  631777
  631778
  631779
  631780
  631781
  631782
  631783
  631784
  631785
  631786
  631787
  631788
  631789
  631790
  631791
  631792
  631793
  631794
  631795
  631796
  631797
  631798
  631799
  631825
  631753
  631800
  631801
  631802
  631803
  631804
  631805
  631806
  631807
  631808
  631809
  631810
  631811
  631812
  631813
  631814
  631815
  631816
  631817
  631818
  631819
  631820
  631821
  631822
  631823
  631824
  631872
  631873
  631874
  631875
  631876
  631877
  631878
  631879
  631880
  631881
  631882
  631883
  631884
  631885
  631886
  631887
  631888
  631889
  631890
  631891
  631892
  631893
  631894
  631826
  631827
  631828
  631829
  631830
  631831
  631832
  631833
  631834
  631835
  631836
  631837
  631838
  631839
  631840
  631841
  631842
  631843
  631844
  631845
  631846
  631847
  631848
  631849
  631850
  631851
  631852
  631853
  631854
  631855
  631856
  631857
  631858
  631859
  631860
  631861
  631862
  631863
  631864
  631865
  631866
  631867
  631868
  631869
  631870
  631871
  631897
  631895
  631896
  631898
  631899
  631900
  631901
  631902
  631903
  631904
  631905
  631906
  631907
  631908
  631909
  631910
  631911
  631912
  631913
  631914
  631915
  631916
  631917
  631918
  631919
  631920
  631921
  631922
  631923
  631924
  631925
  631926
  631927
  631928
  631929
  631930
  631931
  631932
  631933
  631934
  631935
  631936
  631937
  631938
  631939
  631940
  631941
  631942
  631943
  631944
  631945
  631946
  631947
  631948
  631949
  631950
  631951
  631952
  631953
  631954
  631955
  631956
  631957
  631958
  631959
  631960
  631961
  631962
  631963
  631964
  631965
  631966
  631967
  631968
  631969
  631970
  631971
  631972
  631973
  631974
  631975
  631976
  631977
  631978
  631979
  632005
  631980
  631981
  631982
  631983
  631984
  631985
  631986
  631987
  631988
  631989
  631990
  631991
  631992
  631993
  631994
  631995
  631996
  631997
  631998
  631999
  632000
  632001
  632002
  632003
  632004
  632052
  632053
  632054
  632055
  632056
  632057
  632058
  632059
  632060
  632061
  632062
  632063
  632064
  632065
  632066
  632067
  632068
  632069
  632070
  632071
  632072
  632073
  632074
  632075
  632006
  632007
  632008
  632009
  632010
  632011
  632012
  632013
  632014
  632015
  632016
  632017
  632018
  632019
  632020
  632021
  632022
  632023
  632024
  632025
  632026
  632027
  632028
  632029
  632030
  632031
  632032
  632033
  632034
  632035
  632036
  632037
  632038
  632039
  632040
  632041
  632042
  632043
  632044
  632045
  632046
  632047
  632048
  632049
  632050
  632051
  632077
  632078
  632079
  632080
  632081
  632082
  632083
  632084
  632085
  632086
  632087
  632088
  632089
  632090
  632091
  632092
  632093
  632094
  632095
  632096
  632097
  632098
  632099
  632100
  632101
  632102
  632103
  632104
  632105
  632106
  632107
  632108
  632109
  632110
  632111
  632112
  632113
  632076
  632114
  632115
  632116
  632117
  632118
  632119
  632120
  632121
  632122
  632123
  632124
  632125
  632126
  632127
  632128
  632129
  632130
  632131
  632132
  632133
  632134
  632135
  632136
  632137
  632138
  632139
  632140
  632141
  632142
  632143
  632144
  632145
  632146
  632147
  632148
  632149
  632150
  632151
  632152
  632153
  632154
  632155
  632156
  632157
  632158
  632159
  632160
  632161
  632162
  632163
  632164
  632165
  632166
  632167
  632168
`
